<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pantry Pad</title>
<style>
:root{
 --bg:#f6f7fb; --card:#fff; --line:#e5e7eb; --shadow:0 8px 22px rgba(0,0,0,.10);
 --brand:#6a5cff; --brand2:#20c997; --danger:#ff8a80;
}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#222}
[hidden]{display:none!important}

/* THEMES */
body.dark{--bg:#1e1e1e;--card:#2a2a2a;--line:#444;color:#eee}
body.colorful{--bg:#f0f8ff;--card:#fffaf0}
body.muslim{--bg:#f3f8f3;--card:#fff;border-color:#d4af37}
body.kids{--bg:#fff0f6;--card:#fef9ff}
body.xmas{--bg:#fef6f6;--card:#fff;border-color:#c00}
body.spring{--bg:#f0fff0;--card:#fff}

/* HOME */
.home{min-height:100vh;display:grid;gap:22px;place-content:center;padding:26px;background:linear-gradient(135deg,#6a5cff,#20c997);color:#fff;text-align:center}
.topbar{display:flex;justify-content:flex-end;gap:8px;align-items:center;margin-bottom:6px}
.topbar select,.topbar button{padding:8px 12px;border-radius:10px;border:1px solid #fff;background:#fff;color:#222}
.choices{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));width:min(900px,96vw);margin:0 auto}
.choice{display:flex;align-items:center;gap:12px;padding:18px;border-radius:16px;border:none;cursor:pointer;background:#fff;color:#222;box-shadow:var(--shadow);font-size:1rem;text-align:left}
.choice .icon{font-size:1.6rem}

/* HEADER */
header{display:flex;gap:10px;align-items:center;padding:10px 12px;background:#fff;box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
header h1{margin:0;font-size:1.1rem}
header input,header select{padding:8px 12px;border:1px solid var(--line);border-radius:8px;font-size:1rem}
header button{padding:8px 12px;border:none;border-radius:8px;background:var(--brand);color:#fff;font-size:1rem}
header .ghost{background:#fff;color:#333;border:1px solid var(--line)}

.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
.tile{position:relative;background:var(--card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--line)}
.imgwrap{width:100%;aspect-ratio:1/1;background:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden}
.tile img{width:100%;height:100%;object-fit:cover}
.body{padding:12px}
.name{font-weight:700}
.meta{font-size:.9rem;color:#555;margin-top:4px}
.ribbon{position:absolute;top:8px;left:8px;padding:4px 8px;border-radius:8px;font-size:.8rem;background:#fff3cd;color:#7a4e00}
.ribbon.exp{background:#fde2e0;color:#8b1a1a}

/* AI */
.ai-side{position:fixed;top:50%;transform:translateY(-50%);z-index:5;pointer-events:none;text-align:center}
.ai-left{left:6px}.ai-right{right:6px}
.ai-fig{width:72px;height:72px;border-radius:50%;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,.25);background:#fff;border:2px solid #fff;animation:blink 4s infinite}
@keyframes blink{0%,90%,100%{transform:scale(1)}95%{transform:scaleY(.9)}}
.ai-speech{margin-top:6px;max-width:160px;background:#fff;border:1px solid var(--line);border-radius:8px;padding:6px 8px;font-size:.8rem;color:#333;display:none}

/* Dialog */
dialog{width:min(500px,96vw);border:none;border-radius:12px;padding:0;box-shadow:var(--shadow)}
dialog form{padding:16px;display:grid;gap:8px}
dialog input,dialog select{padding:8px;border:1px solid var(--line);border-radius:8px}
dialog footer{display:flex;justify-content:flex-end;gap:8px;padding:10px;border-top:1px solid var(--line)}
.primary{background:var(--brand2);color:#fff;border:none;padding:8px 12px;border-radius:8px}
.ghost2{background:#fff;border:1px solid var(--line);padding:8px 12px;border-radius:8px}
</style>
</head>
<body>

<!-- HOME -->
<section id="home" class="home">
 <div class="topbar">
  <select id="langHome">
    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
    <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
  </select>
  <button id="loginBtn">ğŸ”‘ Login</button>
 </div>
 <h1>ğŸ‘‹ Willkommen im Pantry Pad</h1>
 <p>WÃ¤hle eine Funktion:</p>
 <div class="choices" id="homeChoices"></div>
</section>

<!-- APP -->
<section id="app" hidden>
 <header>
  <button onclick="go('home')" class="ghost">ğŸ </button>
  <h1 id="appTitle">Pantry</h1>
  <input id="q" placeholder="Suchen â€¦">
  <select id="locFilter"><option value="">Alle Orte</option><option>Vorratsschrank</option><option>KÃ¼hlschrank</option><option>Gefrierfach</option></select>
  <button id="add">+ Produkt</button>
  <select id="lang"><option value="de">ğŸ‡©ğŸ‡ª</option><option value="en">ğŸ‡¬ğŸ‡§</option><option value="tr">ğŸ‡¹ğŸ‡·</option></select>
 </header>
 <main><div id="grid" class="grid"></div><div id="empty" hidden>Keine Produkte.</div></main>
</section>

<!-- SHOP -->
<section id="shopPage" class="page" hidden>
 <header><button onclick="go('home')" class="ghost">ğŸ </button><h1>ğŸ›’ Einkaufsliste</h1></header>
 <div id="shopList"></div>
</section>

<!-- DASHBOARD -->
<section id="dashPage" class="page" hidden>
 <header><button onclick="go('home')" class="ghost">ğŸ </button><h1>ğŸ“Š Dashboard</h1></header>
 <div id="dashSoon"></div><div id="dashExp"></div><div id="dashTotal"></div>
</section>

<!-- MARKETS -->
<section id="marketPage" class="page" hidden>
 <header><button onclick="go('home')" class="ghost">ğŸ </button><h1>ğŸª SupermÃ¤rkte</h1></header>
 <div id="marketGrid" class="grid"></div>
</section>

<!-- COOKBOOK -->
<section id="cookPage" class="page" hidden>
 <header><button onclick="go('home')" class="ghost">ğŸ </button><h1>ğŸ“– Kochbuch</h1></header>
 <div id="recipesGrid" class="grid"></div>
</section>

<!-- SETTINGS -->
<section id="settingsPage" class="page" hidden>
 <header><button onclick="go('home')" class="ghost">ğŸ </button><h1>âš™ï¸ Einstellungen</h1></header>
 <div id="settingsBox"></div>
</section>

<!-- AI Figures -->
<div id="aiIlyan" class="ai-side ai-left" hidden><div class="ai-fig">ğŸ˜Š</div><div id="msgIlyan" class="ai-speech">Hallo</div></div>
<div id="aiLiaz" class="ai-side ai-right" hidden><div class="ai-fig">ğŸ˜</div><div id="msgLiaz" class="ai-speech">Hi</div></div>

<!-- Produkt-Dialog -->
<dialog id="dlg">
 <form id="form">
  <input type="hidden" name="id">
  <input name="name" placeholder="Name" required>
  <input name="qty" type="number" value="1">
  <input name="unit" placeholder="Einheit">
  <input name="cat" placeholder="Kategorie">
  <select name="loc"><option>Vorratsschrank</option><option>KÃ¼hlschrank</option><option>Gefrierfach</option></select>
  <input name="mhd" type="date">
  <input name="imgUrl" placeholder="Bild-URL">
 </form>
 <footer>
  <button onclick="dlg.close()" class="ghost2">Abbrechen</button>
  <button id="saveBtn" class="primary">Speichern</button>
 </footer>
</dialog>

<script>
/* STATE */
let IS_ADMIN=false, LANG='de'; let db; const DB='pantry-db', STORE='items';

/* DB */
const openDB=()=>new Promise((res,rej)=>{const r=indexedDB.open(DB,1);r.onupgradeneeded=()=>r.result.createObjectStore(STORE,{keyPath:'id'});r.onsuccess=()=>{db=r.result;res();};});
const st=(m='readonly')=>db.transaction(STORE,m).objectStore(STORE);
const getAll=()=>new Promise(r=>{const q=st().getAll();q.onsuccess=()=>r(q.result||[]);});
const put=(it)=>new Promise(r=>{st('readwrite').put(it).onsuccess=()=>r();});

/* Home Kacheln */
function buildHome(){
 const c=document.getElementById('homeChoices');c.innerHTML='';
 const base=[{id:'inventory',icon:'ğŸ‘€',title:'Nachschauen'},{id:'shop',icon:'ğŸ›’',title:'Einkaufsliste'},{id:'dashboard',icon:'ğŸ“Š',title:'Dashboard'},{id:'markets',icon:'ğŸª',title:'SupermÃ¤rkte'}];
 const admin=[{id:'cookbook',icon:'ğŸ“–',title:'Kochbuch'},{id:'settings',icon:'âš™ï¸',title:'Einstellungen'}];
 (IS_ADMIN?[...base,...admin]:base).forEach(x=>{
  const b=document.createElement('button');b.className='choice';b.innerHTML=`<span class="icon">${x.icon}</span><span>${x.title}</span>`;b.onclick=()=>go(x.id);c.appendChild(b);
 });
}

/* Navigation */
function go(id){
 ['home','app','shopPage','dashPage','marketPage','cookPage','settingsPage'].forEach(x=>document.getElementById(x).hidden=true);
 if(id==='inventory'){document.getElementById('app').hidden=false;renderInventory();}
 if(id==='shop'){document.getElementById('shopPage').hidden=false;renderShop();}
 if(id==='dashboard'){document.getElementById('dashPage').hidden=false;renderDash();}
 if(id==='markets'){document.getElementById('marketPage').hidden=false;renderMarkets();}
 if(id==='cookbook'){document.getElementById('cookPage').hidden=false;renderCook();}
 if(id==='settings'){document.getElementById('settingsPage').hidden=false;renderSettings();}
 if(id==='home'){document.getElementById('home').hidden=false;buildHome();}
}

/* Inventory */
async function renderInventory(){
 const grid=document.getElementById('grid');grid.innerHTML='';
 const items=await getAll();
 if(!items.length){document.getElementById('empty').hidden=false;return;}
 document.getElementById('empty').hidden=true;
 items.forEach(it=>{
  const d=it.mhd?Math.floor((new Date(it.mhd)-new Date())/86400000):null;
  const card=document.createElement('div');card.className='tile';card.dataset.id=it.id;
  card.innerHTML=`<div class="imgwrap"><img src="${it.imgUrl||''}" onerror="this.src='https://via.placeholder.com/150'"></div>
  ${d!==null?(d<0?'<div class="ribbon exp">Abgelaufen</div>':d<=14?'<div class="ribbon">Bald</div>':''):''}
  <div class="body"><div class="name">${it.name}</div><div class="meta">${it.qty} ${it.unit||''}</div></div>`;
  card.onclick=()=>openEdit(it.id);
  grid.appendChild(card);
 });
}

/* Shop */
async function renderShop(){
 const list=document.getElementById('shopList');list.innerHTML='';
 const items=(await getAll()).filter(i=>(i.qty||0)==0);
 if(!items.length){list.innerHTML='Alles da âœ…';return;}
 items.forEach(i=>{const d=document.createElement('div');d.className='stat';d.textContent=i.name;list.appendChild(d);});
}

/* Dashboard */
async function renderDash(){
 const all=await getAll();let soon=all.filter(i=>i.mhd&&Math.floor((new Date(i.mhd)-new Date())/86400000)<=14&&Math.floor((new Date(i.mhd)-new Date())/86400000)>=0);
 let exp=all.filter(i=>i.mhd&&new Date(i.mhd)<new Date());
 document.getElementById('dashSoon').textContent='Bald ablaufend: '+soon.map(x=>x.name).join(', ');
 document.getElementById('dashExp').textContent='Abgelaufen: '+exp.map(x=>x.name).join(', ');
 document.getElementById('dashTotal').textContent='Gesamt: '+all.length;
}

/* Markets */
function renderMarkets(){
 const m=[{n:'Lidl',l:'https://www.lidl.de'},{n:'Aldi',l:'https://www.aldi.de'},{n:'Rewe',l:'https://www.rewe.de'},{n:'Action',l:'https://www.action.com/de-de'},{n:'TÃ¼rkischer Markt',l:'#'}];
 const g=document.getElementById('marketGrid');g.innerHTML='';
 m.forEach(x=>{const c=document.createElement('div');c.className='tile';c.innerHTML=`<div class="imgwrap">${x.n[0]}</div><div class="body"><div class="name">${x.n}</div><a href="${x.l}" target="_blank">Prospekt â–¶ï¸</a></div>`;g.appendChild(c);});
}

/* Cookbook */
function renderCook(){
 const R=[{t:'Menemen',y:'https://www.youtube.com/results?search_query=menemen+sally',i:['Eier','Tomaten','Paprika']},{t:'Pfannkuchen',y:'https://www.youtube.com/results?search_query=pfannkuchen+sally',i:['Mehl','Milch','Ei']}];
 const g=document.getElementById('recipesGrid');g.innerHTML='';
 R.forEach(r=>{const c=document.createElement('div');c.className='tile';c.innerHTML=`<div class="imgwrap">ğŸ³</div><div class="body"><div class="name">${r.t}</div><a href="${r.y}" target="_blank">â–¶ï¸ Video</a></div>`;g.appendChild(c);});
}

/* Settings */
function renderSettings(){
 document.getElementById('settingsBox').innerHTML=`
  <div class="stat"><strong>Themes</strong><br>
   <button onclick="setTheme('')">Hell</button>
   <button onclick="setTheme('dark')">Dunkel</button>
   <button onclick="setTheme('colorful')">Bunt</button>
   <button onclick="setTheme('muslim')">Muslimisch</button>
   <button onclick="setTheme('kids')">Kindlich</button>
   <button onclick="setTheme('xmas')">Weihnachten</button>
   <button onclick="setTheme('spring')">FrÃ¼hling</button>
  </div>
  <div class="stat"><strong>AI Figuren</strong><br><button onclick="toggleAI()">An/Aus</button></div>
 `;
}
function setTheme(t){document.body.className=t;}
function toggleAI(){document.getElementById('aiIlyan').hidden=!document.getElementById('aiIlyan').hidden;document.getElementById('aiLiaz').hidden=!document.getElementById('aiLiaz').hidden;}

/* Dialog */
document.getElementById('add').onclick=()=>{form.reset
